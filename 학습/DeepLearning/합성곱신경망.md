#deep_learning #pytorch #CNN

# 1. 합성곱 신경망 요약 
- 합성곱 신경망(Convoluntional Neural Network, CNN)은 합성곱과 풀링층을 포함하는 이미지 처리성능이 좋은 인공 신경망 알고리즘

![[스크린샷 2024-01-22 오후 4.21.49.png]]

- 합성곱 신경망은 이미지에서 객체, 얼굴, 장면을 인식하기 위해 패턴을 찾는데 유용함
- 대표적인 신경망 : LeNet-5, AlexNet
- 층을 깊게 쌓은 신경망 : VGG, GoogLeNet, ResNet
- 차이점
	- 각 층의 입출력 형상을 유지
	- 이미지의 공간 정보를 유지하면서 인접 이미지와 차이가 있는 특징을 효과적으로 인식
	- 복수 필터로 이미지의 특징을 추출하고 학습
	- 추출한 이미지의 특징을 모으고 강화하는 풀링층이 존재
	- 필터를 공유파라미터로 사용하기 때문에 일반 인공신경망과 비교헤서 학습 파라미터가 매우 적음



# 2. 합성곱 신경망 content
순전파 과정에 따라 계산된 오차 정보가 신경망의 모든 노드로 전송, 이러한 계산과정은 복잡하고 많은 자원을 요구합니다. 계산도 오래 걸립니다. 이 문제를 해결하고자 하는 것이 합성곱 신경망입니다.

합성곱 신경망은 이미지 전체를 한 번에 계산하는 것이 아닌 이미지의 국소적부분을 계산함으로써 시간과 자원을 절약하여 이미지의 세밀한 분석까지 할 수 있는 신경망입니다.

## 2.1 합성곱층의 필요성
합성곱 신경망은 이미지나 영상을 처리하는 데 유용합니다. 예를 들어 3x3 흑백 이미지가 있다고 가정할 때, 

이미지 분석은 3x3배열을 펼쳐서, 각 픽셀에 가중치를 곱하여 은닉층으로 전달하게 됩니다. 이렇게 되면 데이터의 공간적 구조를 무시하게 되는데 이를 방지하려고 도입된 것이 합성곱층 입니다.
###### 이미지

![[스크린샷 2024-01-22 오후 4.30.13.png]]

## 2.2 합성곱 신경망 구조
합성곱 신경망은 다차원 배열 데이터를 처리하도록 구성되어 컬러이미지 같은 다차원 배열 처리에 특화되어 있으며, 계층 5개로 구성됩니다.

- 입력층 -> 합성곱층(+렐루) -> 풀링층 -> 완전 연결층 -> 출력층

합성곱 신경망은 합성곱층과 풀링층을 거치면서 입력 이미지의 주요 특성 벡터를 추출합니다.
##### 이미지
![[스크린샷 2024-01-22 오후 4.43.22.png]]



그 후 추출된 주요 특성 벡터들은 완전 연결층을 거치면서 1차원 벡터로 변환되며, 마지막으로 출력층에서 활성화함수인 소프트백스 함수를 사용하여 최종결과가 출력됩니다.

### 입력층
입력층(Input layer)은 입력 이미지 데이터가 최초로 거치게 되는 계층

이미지는 단순 1차원 데이터가 아닌, 높이, 너비, 채널의 값을 가지는 3차원 데이터입니다.

이때 채널은 이미지가 흑백이면 1의 값, 컬러면 3값을 가집니다.

합성곱층
합성곱층은 입력데이터에서 특성을 추출하는 역할을 수행합니다

그럼 특성추출은 어떻게 진행될까요?

이미지가 들어왔을 때, 이미지에 대한 특성을 감지하기 위해 커널이나 필터를 사용합니다. 커널/필터는 이미지의 모든 영역을 훑으면서 특성을 추출하게 되는데, 이렇게 추출된 결과물이 특성 맵입니다/

이때, 커널은 3x3, 5x5크기로 적용되는 것이 일반적이며, 스트라이드(stride)라는 지정된 간격에 따라 순차적으로 이동합니다.

커널은 스트라이드 간격만큼 순회하면서 모든 입력값과의 합성곱 연산으로 새로운 특성맵을 만들게 되며, 앞의 그림과 같이 커널과 스트라이드의 상호작용으로 (6,6,1)->(4,4,1)크기의 특성맵으로 줄어들었습니다.
#### 흑백 ![[스크린샷 2024-01-22 오후 4.56.47.png]]

##### 컬러

그레이스케일 이미지와 구분되는 특징은 다음과 같습니다.

1. 필터 채널이 3이라는 것
2. rgb 각각에 서로다른 가중치로 합성곱을 적용한 후 결과를 더해 준다는 것

이때 필터 채널이 3이라고 해서 필터개수도 3개라고 오해하기 쉬운데 실제로는 필터 개수가 한개라는 점에 주의

#### 요약
- 입력 데이터 : $W_1 * H_1 * D_1$(가로, 세로 채널)
- 하이퍼 파라미터
	- 필터 개수 : K
	- 필터 크기 : F
	- 스트라이드 : S
	- 패딩 : P


- 출력 데이터
	- $W_2 = (W_1+F+2P)/S+1$
	- $H_2=(H_1+F+2P)/S+1$
	- $D_2= K$



### 풀링층
풀링층은 합성곱층과 유사하게 특성 맵의 차원을 다운 샘플링하여 연산량을 감소시키고, 주요한 특성 벡터를 추출하여 학습을 효과적으로 할 수 있게 함

풀링 연산에는 두가지 사용

- 최대 풀링(max pooling) : 대상 영역에서 최댓값을 추출
- 평균 풀링(average pooling) : 대상 영역에서 평균을 반환

보통은 최대 풀링이 사용되는데, 평균 풀링은 각 커널 값을 평균화시켜 중요한 가중치를 갖는 값의 특성이 희미해질 수 있기 때문입니다.

![[스크린샷 2024-01-22 오후 5.29.02.png]]
![[스크린샷 2024-01-22 오후 5.29.28.png]]

#### 요약
- 입력 데이터 : $W_1 * H_1 * D_1$(가로, 세로 채널)
- 하이퍼 파라미터
	- 필터 크기 : F
	- 스트라이드 : S
- 출력 데이터
	- $W_2 = (W_1-F)/S+1$
	- $H_2=(H_1-F)/S+1$
	- $D_2= D_1$

### 완전연결층
합성곱층과 풀링층을 거치면서 차원이 축소된 특성 맵은 최종적으로 완전연결층으로 전달됩니다.

이 과정에서 이미지는 3차원 벡터에서 1차원 벡터로 펼쳐지게 됩니다.
![[스크린샷 2024-01-22 오후 5.32.49.png]]
### 출력층
출력층에서는 소프트맥스 활성화 함수가 사용되는데, 입력받은 값을 0~1사이의 값으로 출력합니다.

따라서 마지막 출력층의 소프트 맥스 함수를 사용하여 이미지가 각 레이블에 속할 확률값이 출력되며, 이때 가장 높은 확률 값을 갖는 레이블이 최종값으로 선정됩니다.
## 2.3 1D, 2D, 3D 합성곱
### 1D 합성곱
1D 합성곱은 필터가 시간을 축으로 좌우만 이동할 수 있는 합성곱입니다. 따라서 입력과 필터에 대한 출력은 W가 됩니다. 
![[스크린샷 2024-01-22 오후 5.46.42.png]]
### 2D 합성곱
2D합성곱은 필터가 다음그림과 같이 방향 두개로 움직이는 형태입니다. 즉 입력(W,H)과 필터(k,k)에 대한 출력은 (W,H)가 되며, 출력 형태는 2d행렬이 됩니다.
![[스크린샷 2024-01-22 오후 5.47.50.png]]
